from tqdm import tqdm
from django.core.management.base import BaseCommand

from soleadify_ml.models.website import Website
from soleadify_ml.tasks import scrapping


class Command(BaseCommand):
    help = "Add to queue"

    def handle(self, *args, **options):
        websites = Website.objects.raw(
            "select distinct w.id, w.domain from websites w "
            "JOIN website_locations wl on w.id = wl.website_id "
            "JOIN category_websites cw on w.id = cw.website_id "
            "where country_code = 'us' and region_code in ('ca','tx','fl','ny','il') "
            "and category_id IN (10368) and (w.id > 7908547 or w.id in (7905699,7905751,7905704,7905700,7905687,7905770,7905706,7905708,7905796,7905802,7905774,7905781,7905876,7905925,7905961,7905933,7905982,7905977,7905939,7905955,7905990,7906050,7906109,7906136,7906128,7905966,7906100,7906208,7906156,7906242,7906282,7906250,7906334,7906195,7906116,7906357,7906286,7906328,7906340,7906253,7906319,7906377,7906463,7906475,7906476,7906371,7906348,7906517,7906550,7906570,7906591,7906625,7906548,7906539,7906592,7906544,7906577,7906361,7906574,7906679,7906682,7906675,7906452,7906665,7906582,7906687,7906564,7906689,7906771,7906803,7906797,7906749,7906802,7906858,7906898,7906805,7906910,7906933,7906941,7906953,7906943,7907000,7906882,7906931,7906987,7906946,7906873,7907001,7907065,7906830,7907032,7906954,7907087,7907078,7907124,7906887,7907099,7907130,7907174,7907212,7907223,7907216,7907088,7907143,7907142,7907218,7907224,7907247,7907198,7907089,7907194,7907196,7907262,7907300,7907341,7907369,7907387,7907225,7907434,7907416,7907293,7907298,7907491,7907181,7907451,7907512,7907473,7907320,7907443,7907458,7907513,7907568,7907505,7907575,7907558,7907528,7907325,7907519,7907561,7907632,7907517,7907654,7907620,7907678,7907689,7907661,7907494,7907673,7907599,7907713,7907701,7907708,7907768,7907646,7907777,7907580,7907577,7907785,7907831,7907743,7907830,7907880,7907682,7907729,7907892,7907913,7907893,7907904,7907921,7907971,7907873,7907957,7907983,7907984,7907930,7907981,7908009,7908045,7908091,7908048,7908090,7908042,7908106,7908133,7908057,7908093,7908110,7908138,7908170,7908172,7908108,7908132,7907980,7908144,7908214,7908225,7907909,7908234,7908179,7908152,7908191,7908242,7908256,7908309,7908314,7908249,7908129,7908304,7908307,7908315,7908387,7908311,7908325,7908367,7908362,7908375,7908455,7908447,7908361,7908454,7908393,7908418,7908459,7908295,7908501,7908541,7908479,7908525,7908545,7908543,7908546,7908532,7908566,7908736,7908737,7908877,7908869,7908579,7908902,7908727,7908886,7908964))"
        )
        progress_bar = tqdm(desc="Processing", total=len(websites))
        for website in websites:
            website.contact_state = 'pending'
            website.save(update_fields=['contact_state'])
            scrapping.delay(website.id)
            progress_bar.update(1)
        progress_bar.close()
